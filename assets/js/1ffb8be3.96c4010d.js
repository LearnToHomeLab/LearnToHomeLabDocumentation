"use strict";(globalThis.webpackChunkLearn_To_Homelab=globalThis.webpackChunkLearn_To_Homelab||[]).push([[4748],{7834:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>x,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"HomeLab-Series/EP39_MovingProxmoxVMStorage","title":"Move Proxmox VMs & Containers to a New Storage Drive","description":"<div style={{","source":"@site/docs/HomeLab-Series/EP39_MovingProxmoxVMStorage.mdx","sourceDirName":"HomeLab-Series","slug":"/HomeLab-Series/EP39_MovingProxmoxVMStorage","permalink":"/LearnToHomeLabDocumentation/docs/HomeLab-Series/EP39_MovingProxmoxVMStorage","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":41,"frontMatter":{"sidebar_position":41},"sidebar":"tutorialSidebar","previous":{"title":"How to Upload SSH Keys to GitHub and Manage Your SSH Keys","permalink":"/LearnToHomeLabDocumentation/docs/HomeLab-Series/EP38_SSHKeysGithub"},"next":{"title":"Enabling Suricata Rules on OPNsense Firewall","permalink":"/LearnToHomeLabDocumentation/docs/HomeLab-Series/EP40_SuricataRulesOPNsense"}}');var s=o(4848),i=o(8453),l=(o(3573),o(6519),o(7286));const a={sidebar_position:41},t="Move Proxmox VMs & Containers to a New Storage Drive",d={},c=[{value:"Reasons you may need to move VM &amp; container storage:",id:"reasons-you-may-need-to-move-vm--container-storage",level:3},{value:"Moving Proxmox VM Storage",id:"moving-proxmox-vm-storage",level:2},{value:"Moving Container Storage",id:"moving-container-storage",level:2},{value:"Common Errors",id:"common-errors",level:2},{value:"VM is locked (snapshot) (500)",id:"vm-is-locked-snapshot-500",level:3},{value:"Step-by-step unlock in Proxmox shell (main node CLI)",id:"step-by-step-unlock-in-proxmox-shell-main-node-cli",level:3},{value:"Unable to delete snapshot volume (500)",id:"unable-to-delete-snapshot-volume-500",level:3},{value:"Follow Us on Social Media",id:"follow-us-on-social-media",level:2}];function h(e){const n={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"move-proxmox-vms--containers-to-a-new-storage-drive",children:"Move Proxmox VMs & Containers to a New Storage Drive"})}),"\n",(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,s.jsx)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/2pky63gridE?si=xQwIRRmXCbYaxbSn",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"reasons-you-may-need-to-move-vm--container-storage",children:"Reasons you may need to move VM & container storage:"}),"\n",(0,s.jsxs)("div",{class:"informative-section",children:[(0,s.jsx)("div",{class:"circle-emoji",children:"!"}),(0,s.jsx)("p",{children:(0,s.jsx)(n.p,{children:"Upgrading to a larger/faster drive, running out of space, moving to SSD/NVMe for performance, replacing failing hardware, decommissioning drives, reconfiguring RAID/storage pools, consolidating storage, workload separation, improving HA/live migration with network/shared storage, preparing for maintenance/upgrades, optimizing backup or disaster recovery, balancing cluster node resources, capacity expansion, and more."})})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"moving-proxmox-vm-storage",children:"Moving Proxmox VM Storage"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Prepare the VM:"})}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Shut down the VM (optional but recommended)."}),"\n",(0,s.jsxs)(n.li,{children:["Navigate: ",(0,s.jsx)(n.code,{children:"VM \u2192 Hardware \u2192 Hard Disk"})," (e.g., ",(0,s.jsx)(n.code,{children:"scsi0"}),")."]}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Initiate Move Storage:"})}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Click the ",(0,s.jsx)(n.strong,{children:'"Disk Action"'})," dropdown \u2192 select ",(0,s.jsx)(n.strong,{children:'"Move Storage"'}),"."]}),"\n"]}),"\n",(0,s.jsx)(l.A,{folder:"images/EP39_MovingProxmoxVMStorage",name:"image1.png",alt:"Disk Action dropdown"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"In the popup, select:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Target Storage"}),": choose your local storage (e.g., ",(0,s.jsx)(n.code,{children:"local"}),", ",(0,s.jsx)(n.code,{children:"local-lvm"}),")."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(l.A,{folder:"images/EP39_MovingProxmoxVMStorage",name:"image2.png",alt:"Select Target Storage"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Check ",(0,s.jsx)(n.strong,{children:"Delete Source"})," to remove original disk after migration."]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:'"Move Disk"'}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Monitor Progress:"})}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Follow migration progress in Proxmox task log."}),"\n",(0,s.jsxs)(n.li,{children:["Verify in ",(0,s.jsx)(n.code,{children:"Hardware \u2192 Hard Disk"})," that disk now points to local storage."]}),"\n",(0,s.jsx)(n.li,{children:"Remove any unused disk entries."}),"\n"]}),"\n",(0,s.jsx)(l.A,{folder:"images/EP39_MovingProxmoxVMStorage",name:"image3.png",alt:"Migration progress"}),"\n",(0,s.jsx)(l.A,{folder:"images/EP39_MovingProxmoxVMStorage",name:"image4.png",alt:"Ceph pool disk remaining"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"Note:"})," Ceph pool cannot be destroyed or modified until all VM/container disks are removed."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"moving-container-storage",children:"Moving Container Storage"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Turn off the container."}),"\n",(0,s.jsxs)(n.li,{children:["Go to ",(0,s.jsx)(n.strong,{children:"Resources"})," tab (not hardware tab)."]}),"\n",(0,s.jsx)(n.li,{children:"Follow same move storage steps as for VMs."}),"\n"]}),"\n",(0,s.jsx)(l.A,{folder:"images/EP39_MovingProxmoxVMStorage",name:"image5.png",alt:"Container Resources tab"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"common-errors",children:"Common Errors"}),"\n",(0,s.jsx)(n.h3,{id:"vm-is-locked-snapshot-500",children:"VM is locked (snapshot) (500)"}),"\n",(0,s.jsx)(l.A,{folder:"images/EP39_MovingProxmoxVMStorage",name:"image6.png",alt:"VM locked error"}),"\n",(0,s.jsx)(n.h3,{id:"step-by-step-unlock-in-proxmox-shell-main-node-cli",children:"Step-by-step unlock in Proxmox shell (main node CLI)"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Identify locked VM (note VMID):"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"qm list\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Unlock VM:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"qm unlock <VMID>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"qm unlock 100\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"Verify unlock:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"qm config <VMID>\n"})}),"\n",(0,s.jsx)(n.p,{children:"No lock icon should appear next to VM name in UI."}),"\n",(0,s.jsx)(n.h3,{id:"unable-to-delete-snapshot-volume-500",children:"Unable to delete snapshot volume (500)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Make sure VM is off."}),"\n",(0,s.jsx)(n.li,{children:"Unlock VM if locked:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"qm unlock <VMID>\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Force delete orphaned snapshot:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"qm delsnapshot <VMID> <snapshot-name> --force\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Replace ",(0,s.jsx)(n.code,{children:"<snapshot-name>"})," with actual snapshot name (e.g., ",(0,s.jsx)(n.code,{children:"BeforeDiskUpgrade"}),")."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"follow-us-on-social-media",children:"Follow Us on Social Media"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://www.youtube.com/@learntohomelab",children:"YouTube"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.a,{href:"https://discord.gg/6MsHSJWZpH",children:"Discord"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.a,{href:"https://www.patreon.com/c/learntohomelab",children:"Patreon"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.a,{href:"https://www.reddit.com/r/learntohomelab/",children:"Reddit"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.a,{href:"https://rumble.com/c/c-7585051",children:"Rumble"})]})]})}function x(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);