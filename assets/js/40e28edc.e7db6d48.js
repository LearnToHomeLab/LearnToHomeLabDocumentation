"use strict";(globalThis.webpackChunkLearn_To_Homelab=globalThis.webpackChunkLearn_To_Homelab||[]).push([[1724],{310:(e,o,i)=>{i.r(o),i.d(o,{assets:()=>c,contentTitle:()=>h,default:()=>x,frontMatter:()=>d,metadata:()=>n,toc:()=>m});const n=JSON.parse('{"id":"HomeLab-Series/EP21_ProxmoxCeph","title":"How to Setup Ceph on Proxmox and Perform Live VM Migration","description":"In this video, we will cover how to perform live VM migration between Proxmox nodes in a cluster using Ceph as the distributed data storage.","source":"@site/docs/HomeLab-Series/EP21_ProxmoxCeph.mdx","sourceDirName":"HomeLab-Series","slug":"/HomeLab-Series/EP21_ProxmoxCeph","permalink":"/LearnToHomeLabDocumentation/docs/HomeLab-Series/EP21_ProxmoxCeph","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":24,"frontMatter":{"sidebar_position":24},"sidebar":"tutorialSidebar","previous":{"title":"How to Setup a Proxmox Cluster","permalink":"/LearnToHomeLabDocumentation/docs/HomeLab-Series/EP20_ProxmoxClustering"},"next":{"title":"Homarr Upgrade to 1.0","permalink":"/LearnToHomeLabDocumentation/docs/HomeLab-Series/EP22_homarr1.0upgrade"}}');var t=i(4848),r=i(8453),l=i(3573),a=i(6519),s=i(7286);const d={sidebar_position:24},h="How to Setup Ceph on Proxmox and Perform Live VM Migration",c={},m=[{value:"Setting up a Ceph Storage Pool",id:"setting-up-a-ceph-storage-pool",level:2},{value:"Create the Storage Pool",id:"create-the-storage-pool",level:3},{value:"How to Perform Live Migrations of VMs",id:"how-to-perform-live-migrations-of-vms",level:2},{value:"Removing Local Disk for Live Migration",id:"removing-local-disk-for-live-migration",level:3},{value:"Conclusion",id:"conclusion",level:2},{value:"Follow Us on Social Media",id:"follow-us-on-social-media",level:2}];function p(e){const o={a:"a",br:"br",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.header,{children:(0,t.jsx)(o.h1,{id:"how-to-setup-ceph-on-proxmox-and-perform-live-vm-migration",children:"How to Setup Ceph on Proxmox and Perform Live VM Migration"})}),"\n",(0,t.jsx)(o.p,{children:"In this video, we will cover how to perform live VM migration between Proxmox nodes in a cluster using Ceph as the distributed data storage."}),"\n",(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,t.jsx)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/gg_6yAt661g?si=8cPM1Sxq5vvEpBYX",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),"\n",(0,t.jsx)(o.h2,{id:"setting-up-a-ceph-storage-pool",children:"Setting up a Ceph Storage Pool"}),"\n",(0,t.jsx)(o.p,{children:"Steps to create a Ceph cluster:"}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsx)(o.li,{children:"Have dedicated storage for your Ceph pool (SSD, HDD). It CANNOT be the same disk you already use because it will be wiped."}),"\n"]}),"\n",(0,t.jsx)(o.p,{children:"Ensure you have an extra SSD or HDD installed for your Ceph pool."}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.3.1.png",alt:"Ensure dedicated storage device for Ceph pool"}),"\n",(0,t.jsx)(l.A,{emoji:"\u26a0\ufe0f",title:"Important",children:(0,t.jsx)(o.p,{children:"The following commands will need to be done on EVERY node (cluster size dependent)."})}),"\n",(0,t.jsx)(o.p,{children:'Click your node, go to Ceph, and click "Install Ceph."'}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.3.2.png",alt:"Installing Ceph on node"}),"\n",(0,t.jsx)(o.p,{children:"Use Reef (version 18.2). Make sure you install the latest version available at install time. Select the No-Subscription option because we do not pay for Proxmox."}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.3.3.png",alt:"Ceph Reef version install"}),"\n",(0,t.jsx)(o.p,{children:"On the next screen, press enter to confirm and wait for the install to complete."}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.3.4.png",alt:"Ceph installation progress"}),"\n",(0,t.jsx)(o.p,{children:"When the blue Next button is enabled, click Next."}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.4.1.png",alt:"Ceph install next button"}),"\n",(0,t.jsx)(o.p,{children:"Your install should automatically select the network matching that of your node. Confirm and click Next."}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.4.2.png",alt:"Ceph network settings"}),"\n",(0,t.jsx)(o.h3,{id:"create-the-storage-pool",children:"Create the Storage Pool"}),"\n",(0,t.jsx)(o.p,{children:'Click your node name, go to Disks, select your dedicated storage device, and click "Wipe Disk."'}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.5.1.png",alt:"Wipe dedicated storage device"}),"\n",(0,t.jsx)(o.p,{children:"Return to the Ceph menu dropdown near the node name, select OSD, select the wiped device, and click Create."}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.5.2.png",alt:"Create OSD from wiped disk"}),"\n",(0,t.jsx)(o.p,{children:"Click Pools below the OSD menu, then click Create in the top left."}),"\n",(0,t.jsx)(o.p,{children:"Set the pool size according to your number of nodes/OSD drives. For example, with two nodes and two drives, set pool size to two. Leave PG autoscaler mode on."}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.6.1.png",alt:"Create pool with size setting"}),"\n",(0,t.jsx)(o.h2,{id:"how-to-perform-live-migrations-of-vms",children:"How to Perform Live Migrations of VMs"}),"\n",(0,t.jsx)(o.p,{children:"To live migrate a VM, its storage must reside on the Ceph pool."}),"\n",(0,t.jsx)(o.p,{children:"When creating a VM, on the Disks page select your Ceph pool as the storage option."}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.7.1.png",alt:"Selecting Ceph pool for VM disk"}),"\n",(0,t.jsx)(a.A,{emoji:"\u2139\ufe0f",title:"Note",children:(0,t.jsx)(o.p,{children:"You can edit existing VMs to move their storage to the Ceph pool to enable live migration."})}),"\n",(0,t.jsx)(o.h3,{id:"removing-local-disk-for-live-migration",children:"Removing Local Disk for Live Migration"}),"\n",(0,t.jsx)(o.p,{children:"Live migration will NOT work if a CD/DVD device is attached. This device is only needed for initial OS installation."}),"\n",(0,t.jsx)(o.p,{children:"Steps:"}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsx)(o.li,{children:"Power off your VM."}),"\n",(0,t.jsx)(o.li,{children:"Select the CD/DVD device under Hardware."}),"\n",(0,t.jsx)(o.li,{children:"Click Remove."}),"\n",(0,t.jsx)(o.li,{children:"Power on the VM again."}),"\n"]}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.7.2.png",alt:"Removing CD/DVD device from VM"}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsx)(o.em,{children:(0,t.jsx)(o.strong,{children:"Example of live migration failing with a local CD/DVD attached:"})})}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.7.3.png",alt:"Live migration failure example"}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsx)(o.em,{children:(0,t.jsx)(o.strong,{children:"Example with CD/DVD removed:"})})}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.7.4.png",alt:"Live migration possible after removing CD/DVD"}),"\n",(0,t.jsx)(o.p,{children:"Now, with the CD/DVD removed and VM running, select the target node to migrate to and click Migrate."}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.7.6.png",alt:"Migrate VM to target node"}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsx)(o.em,{children:(0,t.jsx)(o.strong,{children:"Live feed of the migration process:"})})}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.7.7.png",alt:"Live migration progress feed"}),"\n",(0,t.jsx)(o.p,{children:"After migration, the VM runs on the new node with nearly zero downtime."}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.7.8.png",alt:"VM successfully migrated"}),"\n",(0,t.jsx)(o.p,{children:"You can now move all VMs away from a node to perform maintenance without downtime or service disruption."}),"\n",(0,t.jsx)(s.A,{folder:"images/EP21_ProxmoxCeph",name:"Still 2025-02-18 105326_1.7.9.png",alt:"Maintenance without downtime"}),"\n",(0,t.jsx)(o.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,t.jsx)(o.p,{children:"This video covered:"}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsx)(o.li,{children:"How to wipe drives."}),"\n",(0,t.jsx)(o.li,{children:"How to create a Ceph Pool."}),"\n",(0,t.jsx)(o.li,{children:"How to live migrate VMs."}),"\n",(0,t.jsx)(o.li,{children:"How to update other systems without disrupting user availability."}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"follow-us-on-social-media",children:"Follow Us on Social Media"}),"\n",(0,t.jsxs)(o.p,{children:[(0,t.jsx)(o.a,{href:"https://www.youtube.com/@learntohomelab",children:"YouTube"}),(0,t.jsx)(o.br,{}),"\n",(0,t.jsx)(o.a,{href:"https://discord.gg/6MsHSJWZpH",children:"Discord"}),(0,t.jsx)(o.br,{}),"\n",(0,t.jsx)(o.a,{href:"https://www.patreon.com/c/learntohomelab",children:"Patreon"}),(0,t.jsx)(o.br,{}),"\n",(0,t.jsx)(o.a,{href:"https://www.reddit.com/r/learntohomelab/",children:"Reddit"}),(0,t.jsx)(o.br,{}),"\n",(0,t.jsx)(o.a,{href:"https://rumble.com/c/c-7585051",children:"Rumble"})]})]})}function x(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}}}]);