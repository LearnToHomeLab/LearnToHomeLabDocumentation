"use strict";(globalThis.webpackChunkLearn_To_Homelab=globalThis.webpackChunkLearn_To_Homelab||[]).push([[779],{1619:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>d,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"HomeLab-Series/EP41_OPNsense ISC DHCP Migration to Dndsmasq DHCP","title":"Upgrade OPNsense ISC DHCP to Dnsmasq and DHCP","description":"<div style={{","source":"@site/docs/HomeLab-Series/EP41_OPNsense ISC DHCP Migration to Dndsmasq DHCP.mdx","sourceDirName":"HomeLab-Series","slug":"/HomeLab-Series/EP41_OPNsense ISC DHCP Migration to Dndsmasq DHCP","permalink":"/LearnToHomeLabDocumentation/docs/HomeLab-Series/EP41_OPNsense ISC DHCP Migration to Dndsmasq DHCP","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":43,"frontMatter":{"sidebar_position":43},"sidebar":"tutorialSidebar","previous":{"title":"Enabling Suricata Rules on OPNsense Firewall","permalink":"/LearnToHomeLabDocumentation/docs/HomeLab-Series/EP40_SuricataRulesOPNsense"},"next":{"title":"Software Tutorials","permalink":"/LearnToHomeLabDocumentation/docs/category/software-tutorials"}}');var r=n(4848),l=n(8453),t=(n(3573),n(6519),n(7286));const a={sidebar_position:43},d="Upgrade OPNsense ISC DHCP to Dnsmasq and DHCP",o={},c=[{value:"What this tutorial covers:",id:"what-this-tutorial-covers",level:2},{value:"Update OPNsense to Latest",id:"update-opnsense-to-latest",level:2},{value:"Backup Your Settings",id:"backup-your-settings",level:2},{value:"Download Static DHCP Mappings",id:"download-static-dhcp-mappings",level:2},{value:"Setup Dnsmasq DNS &amp; DHCP",id:"setup-dnsmasq-dns--dhcp",level:2},{value:"IPv4 Settings:",id:"ipv4-settings",level:3},{value:"IPv6 Settings:",id:"ipv6-settings",level:3},{value:"Upload Static Mappings",id:"upload-static-mappings",level:2},{value:"Disable Router Advertisements",id:"disable-router-advertisements",level:2},{value:"Disable ISC DHCPv4 and DHCPv6",id:"disable-isc-dhcpv4-and-dhcpv6",level:2},{value:"Enable Dnsmasq &amp; DHCP",id:"enable-dnsmasq--dhcp",level:2},{value:"Set DHCP Reservations",id:"set-dhcp-reservations",level:2},{value:"Verify DHCP &amp; DNS",id:"verify-dhcp--dns",level:2},{value:"Follow Us on Social Media",id:"follow-us-on-social-media",level:2}];function h(e){const s={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"upgrade-opnsense-isc-dhcp-to-dnsmasq-and-dhcp",children:"Upgrade OPNsense ISC DHCP to Dnsmasq and DHCP"})}),"\n",(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,r.jsx)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/AzJB6Mx3CnQ?si=Wp3TwgIquBmnOMyU",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),"\n",(0,r.jsx)(s.h2,{id:"what-this-tutorial-covers",children:"What this tutorial covers:"}),"\n",(0,r.jsxs)(s.p,{children:["Update to Dnsmasq DNS & DHCP services, replacing deprecated [translate",":ISC"," DHCPv4/DHCPv6]. This includes disabling legacy DHCP, configuring new settings, and validating DHCP and DNS functionality."]}),"\n",(0,r.jsx)(s.h2,{id:"update-opnsense-to-latest",children:"Update OPNsense to Latest"}),"\n",(0,r.jsx)(s.p,{children:"Check updates via:"}),"\n",(0,r.jsx)(t.A,{folder:"images/EP41_iscdhcp_dnsmasqdhcp",name:"opnsense updates.png",alt:"OPNsense latest updates"}),"\n",(0,r.jsx)(s.p,{children:"After checking, follow the wizard to install updates."}),"\n",(0,r.jsx)(s.h2,{id:"backup-your-settings",children:"Backup Your Settings"}),"\n",(0,r.jsx)(s.p,{children:"Always back up before making major changes:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"System > Configuration > Backups > Download Configuration"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"download-static-dhcp-mappings",children:"Download Static DHCP Mappings"}),"\n",(0,r.jsx)(s.p,{children:"Download your static DHCP mappings from:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Services > [translate",":ISC"," DHCPv4] > LAN"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Save the CSV."}),"\n",(0,r.jsx)(s.h2,{id:"setup-dnsmasq-dns--dhcp",children:"Setup Dnsmasq DNS & DHCP"}),"\n",(0,r.jsxs)(s.p,{children:["In ",(0,r.jsx)(s.strong,{children:"Services > Dnsmasq DNS & DHCP > General"}),":"]}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Set ",(0,r.jsx)(s.em,{children:"interfaces"})," to ",(0,r.jsx)(s.code,{children:"LAN"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Set ",(0,r.jsx)(s.em,{children:"listen port"})," to ",(0,r.jsx)(s.code,{children:"0"})," (allows Unbound DNS to handle all queries)."]}),"\n",(0,r.jsxs)(s.li,{children:["Enable ",(0,r.jsx)(s.em,{children:"Do not forward to system defined DNS servers"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Click ",(0,r.jsx)(s.strong,{children:"Apply"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"ipv4-settings",children:"IPv4 Settings:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Interface"}),": LAN"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Start address"}),": 192.168.1.2"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"End address"}),": 192.168.1.254"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Description"}),": (Description for subnet)"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"ipv6-settings",children:"IPv6 Settings:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Interface"}),": LAN"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Start address"}),": ::1000"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"End address"}),": ::2000"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Description"}),": (Description for subnet)"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"upload-static-mappings",children:"Upload Static Mappings"}),"\n",(0,r.jsxs)(s.p,{children:["Go to ",(0,r.jsx)(s.strong,{children:"Hosts"})," tab, upload the CSV from earlier."]}),"\n",(0,r.jsx)(t.A,{folder:"images/EP41_iscdhcp_dnsmasqdhcp",name:"importyourfile.png",alt:"Upload static CSV"}),"\n",(0,r.jsx)(s.h2,{id:"disable-router-advertisements",children:"Disable Router Advertisements"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Services > Router Advertisements > LAN"}),"\n",(0,r.jsxs)(s.li,{children:["Set to ",(0,r.jsx)(s.strong,{children:"disabled"})," and ",(0,r.jsx)(s.strong,{children:"Save"}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.A,{folder:"images/EP41_iscdhcp_dnsmasqdhcp",name:"rtad.png",alt:"Disable router adv"}),"\n",(0,r.jsx)(s.h2,{id:"disable-isc-dhcpv4-and-dhcpv6",children:"Disable ISC DHCPv4 and DHCPv6"}),"\n",(0,r.jsxs)(s.p,{children:["In ",(0,r.jsx)(s.strong,{children:"Services > ISC DHCPv4 / DHCPv6 > LAN"}),":"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Uncheck"})," ",(0,r.jsx)(s.strong,{children:"Enabled"})]}),"\n",(0,r.jsxs)(s.li,{children:["Hit ",(0,r.jsx)(s.strong,{children:"Save"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note:"})," Do this quickly to avoid losing DHCP lease."]}),"\n",(0,r.jsx)(s.h2,{id:"enable-dnsmasq--dhcp",children:"Enable Dnsmasq & DHCP"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Services > Dnsmasq DNS & DHCP > General"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Check ",(0,r.jsx)(s.strong,{children:"Enabled"})," and ",(0,r.jsx)(s.strong,{children:"Apply"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"set-dhcp-reservations",children:"Set DHCP Reservations"}),"\n",(0,r.jsxs)(s.p,{children:["In ",(0,r.jsx)(s.strong,{children:"Leases"}),", click ",(0,r.jsx)(s.strong,{children:"+"})," icon for static assignments. Enter description, IP address, and save."]}),"\n",(0,r.jsx)(t.A,{folder:"images/EP41_iscdhcp_dnsmasqdhcp",name:"importyourfile.png",alt:"Upload static CSV"}),"\n",(0,r.jsx)(s.h2,{id:"verify-dhcp--dns",children:"Verify DHCP & DNS"}),"\n",(0,r.jsx)(s.p,{children:"Check DHCP leases and ensure DNS resolution via:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"nslookup google.com\n"})}),"\n",(0,r.jsx)(s.p,{children:"You should see your OPNsense IP resolving."}),"\n",(0,r.jsx)(t.A,{folder:"images/EP41_iscdhcp_dnsmasqdhcp",name:"nslookup.png",alt:"nslookup output"}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"follow-us-on-social-media",children:"Follow Us on Social Media"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.a,{href:"https://www.youtube.com/@learntohomelab",children:"YouTube"}),(0,r.jsx)(s.br,{}),"\n",(0,r.jsx)(s.a,{href:"https://discord.gg/6MsHSJWZpH",children:"Discord"}),(0,r.jsx)(s.br,{}),"\n",(0,r.jsx)(s.a,{href:"https://www.patreon.com/c/learntohomelab",children:"Patreon"}),(0,r.jsx)(s.br,{}),"\n",(0,r.jsx)(s.a,{href:"https://www.reddit.com/r/learntohomelab/",children:"Reddit"}),(0,r.jsx)(s.br,{}),"\n",(0,r.jsx)(s.a,{href:"https://rumble.com/c/c-7585051",children:"Rumble"})]})]})}function p(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);